// jquery.gridview.min.js | v0.8.6-20 | Copyright (C) 2013 SteadyRain, Inc. | steadyrain.com
;(function(b,r,s,l){function p(a,c){this.$element=b(a);this.options=b.extend({},q,c);this._defaults=b.extend({},q,{sort:{direction:"asc",property:null}});this._name=m;this._class="gridview";this._data=null;this._pages=0;this._sort=this._defaults.sort;this._breaker={};this.$thead=this.$element.find("thead");this.$tbody=this.$element.find("tbody");this.$tfoot=this.$element.find("tfoot");this.$pager=this.$tfoot.find("."+this._class+"-pager");b.isFunction(b.fn.on)?(this.$element.on("click","thead th",
b.proxy(this._clickedColumn,this)),this.$element.on("click","tfoot ."+this._class+"-pager a",b.proxy(this._clickedPager,this))):(this.$thead.find("th").live("click",b.proxy(this._clickedColumn,this)),this.$pager.find("a").live("click",b.proxy(this._clickedPager,this)));this._init()}var m="gridview",q={columns:[],data:[],filters:[],gridClass:null,pagerClass:null,pageClass:null,alternateClass:null,sortableClass:"sortable",sortedClass:"sorted",sortedAscClass:null,sortedDescClass:null,width:"100%",pageable:!0,
pagerText:!0,pageCount:!1,sortable:!0,resetFilters:!0,lazyload:!1,webService:null,pageIndex:0,resultsPerPage:5,emptyDataTemplate:"No results were found.",databound:null,rowdatabound:null,sorting:null,sorted:null,formatter:null,mode:"default",modeOptions:null};p.prototype={databind:function(a){"undefined"===typeof a&&b.error("Invalid datasource.");this._resetInternals(this.options.resetFilters?!0:l);this.options.data=a;this._renderData()},mode:function(a,c){this.options.mode="default"===a||"group"===
a?a:"default";this.options.modeOptions=c;this._resetInternals(this.options.resetFilters?!0:l);this._renderData()},option:function(){var a=arguments[0],c=arguments[1];return 0===arguments.length?this.options:"string"===typeof a&&"undefined"===typeof c?this.options[a]:"string"===typeof a&&"undefined"!==typeof c?this.options[a]=c:"object"===typeof a?this.options=b.extend(this.options,a):!1},reload:function(){this._renderData(this._data)},_init:function(){var a=this;b.each(["databound","sorting","sorted"],
function(c,b){a.options[b]&&a.$element.bind(b,a.options[b])});a.$element.attr("class",a.$element.attr("class")?a.$element.attr("class")+" "+a._class:a._class);0===a.$thead.length?a.$thead=a.$element.append(b("<thead>").append(b("<tr>"))):0===a.$thead.find("tr").length&&a.$thead.append(b("<tr>"));0===a.$tbody.length&&(a.$tbody=b("<tbody>").insertAfter(a.$element.find("thead")));0===a.$tfoot.length?a.$tfoot=b("<tfoot>").append(b("<tr>")).appendTo(a.$element):0===a.$tfoot.find("tr").length&&a.$tfoot.append(b("<tr>"));
a.$element.attr("style","width: "+a.options.width+(a.$element.attr("style")===l?"":"; "+a.$element.attr("style")));a.options.gridClass&&a.$element.addClass(a.options.gridClass);0<a.options.columns.length&&a._renderColumns();0<a.options.data.length&&a._renderData();a._bindFilters()},_bindFilters:function(){var a=this;b.each(this.options.filters,function(c,d){(d.trigger||d.control).on(d.event||"change",function(){a._resetInternals();a._renderData(a._data=a._filter(a.options.data,b.proxy(a._filterData,
a,this)))})})},_clickedColumn:function(a){a=b(a.target);this.options.sortable&&a.hasClass(this.options.sortableClass)&&(this._sort.property===a.data("property")?this._sort.direction="asc"===this._sort.direction?"desc":"asc":(this._sort.direction="asc",this._sort.property=a.data("property")),this.options.pageIndex=0,this._updateColumns(a),this._renderData(this._data))},_clickedPager:function(a){if(this.options.pageable){switch(b(a.target).data("page")){case "--":0!==this.options.pageIndex&&this.options.pageIndex--;
break;case "++":this.options.pageIndex+1!==this._pages&&this.options.pageIndex++;break;default:this.options.pageIndex=+b(a.target).data("page")}this._renderData(this._data)}},_filterData:function(a,c){var d=this,e=!0;b.each(d.options.filters,function(g,f){var h=!1,k=null,n=b(1===f.control.length?f.control:f._last||a.target||a);1!==f.control.length&&f.control.filter(b(a))&&(f._last=n=b(a));if(1!==f.control.length&&!f._last)return!0;f.object!==l&&(k=d._first(d.options.filters||[],function(a){return a.object===
f.object&&a.properties!==f.properties}));b.each(f.properties||d._keys(c),function(){var a=(f.attr?n.attr(f.attr):n.val()).toString().toLowerCase();if(null!==k){var e=b(1===k.control.length?k.control:k._last),g=(k.attr?e.attr(k.attr):e.val()).toString().toLowerCase();b.isArray(c[f.object])?h=1===b.grep(c[f.object],function(c){var d=!1;exit=!1;b.each(f.properties,function(b,e){(d=c[e]==a)||(exit=!0);return!exit});exit||b.each(k.properties,function(a,b){(d=c[b]==g)||(exit=!0);return!exit});return d&&
!exit}).length:b.error("[jquery.gridview]: Currently not supported method.")}else h=f.fuzzy?~d._getValue(c,this).toString().toLowerCase().indexOf(a)||a===(n.data("default")||"").toString().toLowerCase():d._getValue(c,this).toString().toLowerCase()===a||a===(n.data("default")||"").toString().toLowerCase();return!h});if(!h)return e=h});return e},_getValue:function(a,c){var d=this,e="";b.each(c.split("."),function(g,f){if(!a||e)return e;b.isArray(a[f])&&b.each(a[f],function(){b.isArray(e)||(e=[]);e.push(d._getValue(this,
c.split(".")[g+1]))});if("object"!==typeof a[f])return e=a[f];a=a[f]});return e},_renderColumns:function(){var a=this,c="";b.each(a.options.columns,function(b,e){c+='<th data-property="'+e.property+'"';a.options.sortable&&(e.sortable!==l?e.sortable:1)&&(c+=' class="'+a.options.sortableClass+'"');c+=' style="white-space: nowrap">'+e.label+"</th>"});a.$element.find("thead tr").html(c)},_renderData:function(a){var c=this;c.$tbody.empty();if(a&&1>a.length||1>c.options.data.length)c.$tbody.append(b("<tr>").append(b("<td>").attr("colspan",
c.options.columns.length).text(c.options.emptyDataTemplate))),c.options.pageable&&c._renderPager();else{var d=b.extend(!0,[],a||c.options.data);a=+c.options.pageIndex*c.options.resultsPerPage;var e=a+c.options.resultsPerPage,g=null,f=rowHTML="";c._sort.property&&(d=c._sortData(d,c._sort.property),"desc"===c._sort.direction&&d.reverse());if("default"===c.options.mode)d=d.slice(a,e),c.options.formatter&&c.options.formatter(d),b.each(d,function(a,d){g=b("<tr>");c.options.alternateClass&&1===a%2&&g.addClass(c.options.alternateClass);
rowHTML="";b.each(c.options.columns,function(a,b){rowHTML+='<td class="'+(b._class||b.property.toLowerCase().replace(/\./g,"-"))+'">';rowHTML+=c._getValue(d,b.property);rowHTML+="</td>"});c.options.rowdatabound&&c.options.rowdatabound(g.html(rowHTML),d);f+=g.html(g.html()||rowHTML).wrap("<p>").parent().html()});else if("group"===c.options.mode){var h=c.options.modeOptions.groupProp,k=[];dataLength=0;if(!h)return;d=d.slice(a,e);console.log(d);b.each(d,function(a,d){b.isArray(d[h])?b.each(d[h],function(a,
d){1>b.grep(k,function(a){return a[c.options.modeOptions.groupTitleProp]===d[c.options.modeOptions.groupTitleProp]}).length&&k.push(b.extend(!0,{},d))}):b.isPlainObject(d[h])?1>b.grep(k,function(a){return a[c.options.modeOptions.groupTitleProp]===d[h][c.options.modeOptions.groupTitleProp]}).length&&k.push(d[h]):1>b.grep(k,function(a){return a.ID===d[h]}).length&&k.push({ID:d[h]})});console.log(d);b.each(k,function(a,e){var f=b("<tr>").addClass("group").addClass(c._getValue(e,c.options.modeOptions.groupTitleProp||
"ID").toLowerCase().replace(/[^A-Za-z0-9]+/g,"-"));e.data=[];b.each(d,function(a,d){b.isArray(d[h])?b.each(d[h],function(a,f){f[c.options.modeOptions.groupTitleProp]===e[c.options.modeOptions.groupTitleProp]&&e.data.push(b.extend(!0,{},d))}):b.isPlainObject(d[h])?d[h][c.options.modeOptions.groupTitleProp]===e[c.options.modeOptions.groupTitleProp]&&e.data.push(b.extend(!0,{},d)):d[h]===e.ID&&e.data.push(b.extend(!0,{},d))});c.options.modeOptions.groupFormatter&&c.options.modeOptions.groupFormatter(e);
rowHTML="";rowHTML+='<td colspan="'+c.options.columns.length+'">';rowHTML+=c._getValue(e,c.options.modeOptions.groupTitleProp||"ID");rowHTML+="</td>";e.header=f.html(f.html()||rowHTML).wrap("<p>").parent().html()});b.each(k,function(a,d){c.options.formatter&&c.options.formatter(d.data);b.each(d.data,function(a,e){if(++dataLength>c.options.resultsPerPage)return!1;0===a&&(f+=d.header);g=b("<tr>");c.options.alternateClass&&1===a%2&&g.addClass(c.options.alternateClass);rowHTML="";b.each(c.options.columns,
function(a,d){rowHTML+='<td class="'+(d._class||d.property.toLowerCase().replace(/\./g,"-"))+'">';rowHTML+=c._getValue(e,d.property);rowHTML+="</td>"});c.options.rowdatabound&&c.options.rowdatabound(g.html(rowHTML),e);f+=g.html(g.html()||rowHTML).wrap("<p>").parent().html()})})}c.$tbody.html(f);c._renderPager();c.options.databound&&c.$element.trigger("databound")}},_renderPager:function(){var a=this._data||this.options.data;if(!this.options.pageable&&!this.options.pageCount||1>=Math.ceil(a.length/
this.options.resultsPerPage))if(0<this.$pager.length)this.$pager.empty();else return;0===this.$pager.length&&(this.$pager=b("<td>",{colspan:this.options.columns.length,style:"display: table-cell"}).appendTo(this.$tfoot.find("tr")));var a=Math.ceil(a.length/this.options.resultsPerPage),c=0,d=0,e="",c=1<this.options.pageIndex?this.options.pageIndex-2:0,d=c+5>a?a:c+5;d===a&&5!==d-c&&(c=-1<d-5?d-5:0);var g=5!==d-c;g||(e='<a class="first" href="javascript:;" data-page="0">'+(this.options.pagerText?"&lt;&lt;":
"")+"</a>");for(1<d&&(e+='<a href="javascript:;" data-page="--">'+(this.options.pagerText?"&lt;":"")+"</a>");c<d;c++)e+='<a href="javascript:;"'+(c===this.options.pageIndex?' class="active"':"")+' data-page="'+c+'">'+(this.options.pagerText?c+1:"")+"</a>";1<d&&(e+='<a href="javascript:;" data-page="++">'+(this.options.pagerText?"&gt;":"")+"</a>");g||(e+='<a class="last" href="javascript:;" data-page="'+--a+'">'+(this.options.pagerText?"&gt;&gt;":"")+"</a>");this.options.pageCount&&(e='<div class="'+
this._class+'-page-count">Page <span class="page-count-current">'+(this.options.pageIndex+1)+'</span> of <span class="page-count-total">'+(g?a:++a)+'</span></div><div class="'+this._class+'-pager">'+e+"</div>");this.options.pagerClass&&!this.$pager.find("."+this.options.pagerClass).length?this.options.pageCount?this.$pager.find("."+this._class+"-pager").addClass(this.options.pagerClass):this.$pager.attr("class",this._class+"-pager "+this.options.pagerClass):this.$pager.addClass(this._class+"-pager");
this.$pager.html(~-a&&this.options.pageable?e:this.options.pageCount?b("<p>").html(e).find("."+this._class+"-page-count").get(0):"");this._pages=a;this.options.pageClass&&this.$pager.find("a").addClass(this.options.pageClass)},_resetInternals:function(a){this._data=null;this.options.pageIndex=0;this._sort=this._defaults.sort;this._updateColumns();a!==l&&b.each(this.options.filters,function(a,d){d._last&&(d._last=null);if(1<d.control.length)return!0;d.attr||d.control.val(d.control.data("default")||
"")})},_updateColumns:function(a){this.$thead.find("i").remove().end().find("th").removeClass(this.options.sortedClass);a!==l&&a.addClass(this.options.sortedClass).append(b("<i>").addClass("asc"===this._sort.direction?this.options.sortedAscClass||"":this.options.sortedDescClass||""))},_isNumeric:function(a){return b.isFunction(b.fn.isNumeric)?b.isNumeric(a):!isNaN(parseFloat(a))&&isFinite(a)},_keys:function(a){return b.map(a,function(c,d){if(a.hasOwnProperty(d))return d})},_first:function(a,c){for(var d=
0;d<a.length;d++)if(c(a[d]))return a[d];return null},_each:function(a,c,d){if(null!==a)if(Array.prototype.forEach&&a.forEach===Array.prototype.forEach)a.forEach(c,d);else if(a.length===+a.length)for(var b=0,g=a.length;b<g&&c.call(d,a[b],b,a)!==this._breaker;b++);else for(b in a)if(Object.prototype.call(a,b)&&c.call(d,a[b],b,a)===this._breaker)break},_filter:function(a,c,d){var b=[];if(null==a)return b;if(Array.prototype.filter&&a.filter===Array.prototype.filter)return a.filter(c,d);this._each(a,function(a,
f,h){c.call(d,a,f,h)&&(b[b.length]=a)});return b},_map:function(a,c,b){var e=[];if(null===a)return e;if(Array.prototype.map&&a.map===Array.prototype.map)return a.map(c,b);this._each(a,function(a,f,h){e[e.length]=c.call(b,a,f,h)});return e},_pluck:function(a,c){return this._map(a,function(a){return a[c]})},_sortData:function(a,c,b){var e=this,g=function(a){return e._getValue(a,c)};return this._pluck(this._map(a,function(a,c,e){return{value:a,index:c,criteria:g.call(b,a,c,e)}}).sort(function(a,c){var b=
a.criteria.toString().toLowerCase(),d=c.criteria.toString().toLowerCase();/^(\-|NaN$)/.test(Date.parse(b))||/^(\-|NaN$)/.test(Date.parse(d))||(b=Date.parse(b),d=Date.parse(d));e._isNumeric(b)&&e._isNumeric(d)&&(b=parseFloat(b),d=parseFloat(d));if(b!==d){if(b>d||void 0===b)return 1;if(b<d||void 0===d)return-1}return a.index<c.index?-1:1}),"value")}};b.fn[m]=function(a){var c=arguments;if(a===l||"object"===typeof a)return this.each(function(){b.data(this,"plugin_"+m)||b.data(this,"plugin_"+m,new p(this,
a))});if("string"===typeof a&&"_"!==a[0]&&"init"!==a){var d;this.each(function(){var e=b.data(this,"plugin_"+m);e instanceof p&&"function"===typeof e[a]&&(d=e[a].apply(e,Array.prototype.slice.call(c,1)))});return d!==l?d:this}}})(jQuery,this,document);