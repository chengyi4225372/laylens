// jquery.listview.js | v0.5.0-1 | Copyright (C) 2013 SteadyRain, Inc. | steadyrain.com
;(function(c,p,q,l){function m(a,b){this.$element=c(a);this.options=c.extend({},n,b);this._defaults=c.extend({},n,{sort:{direction:"asc",property:null}});this._name=h;this._class="listview";this._sort=this._defaults.sort;this.$layout=c(this.options.layoutTemplate).appendTo(this.$element);this.$pager=this.$element.find("."+this._class+"-pager");if(c.isFunction(c.fn.on))this.$element.on("click","."+this._class+"-pager a",c.proxy(this._clickedPager,this));else this.$pager.find("a").live("click",c.proxy(this._clickedPager,
this));this._init()}var h="listview",n={items:[],data:[],pagerClass:null,pageClass:null,itemClass:null,itemAlternateClass:null,layoutClass:null,groupClass:null,width:"100%",pageable:!0,lazyload:!1,webService:null,pageIndex:0,resultsPerPage:5,groupItemCount:5,emptyDataTemplate:"No results were found.",layoutTemplate:"<div>",groupTemplate:"<div>",itemTemplate:null,databound:null,groupdatabound:null,itemdatabound:null,formatter:null};m.prototype={databind:function(a){"undefined"===typeof a&&c.error("Invalid datasource.");
this.options.data=a;this._renderData()},option:function(){var a=arguments[0],b=arguments[1];return 0===arguments.length?this.options:"string"===typeof a&&"undefined"===typeof b?this.options[a]:"string"===typeof a&&"undefined"!==typeof b?this.options[a]=b:"object"===typeof a?this.options=c.extend(this.options,a):!1},reload:function(){this._renderData()},search:function(a){this.options.data=this._filter(this.options.data,function(b){for(var d in b)if(b.hasOwnProperty(d)&&~this._getValue(b,d).toString().toLowerCase().indexOf(a.toLowerCase()))return!0;
return!1});this._renderData()},sort:function(a){this._sort.direction=this._sort.property===a?"asc"===this._sort.direction?"desc":"asc":"asc";this._sort.property=a;this._renderData()},_init:function(){var a=this;c.each(["databound"],function(b,d){a.options[d]&&a.$element.bind(d,a.options[d])});a.$element.attr("class",a.$element.attr("class")?a.$element.attr("class")+" "+a._class:a._class);a.$element.attr("style","width: "+a.options.width+(a.$element.attr("style")===l?"":"; "+a.$element.attr("style")));
a.options.layoutClass&&a.$layout.addClass(a.options.layoutClass);0<a.options.data.length&&a._renderData()},_clickedPager:function(a){if(this.options.pageable){switch(c(a.target).data("page")){case "--":this.options.pageIndex--;break;case "++":this.options.pageIndex++;break;default:this.options.pageIndex=parseInt(c(a.target).data("page"))}this._renderData()}},_getValue:function(a,b){var d=null;c.each(b.split("."),function(b,c){if("object"!==typeof a[c])return d=a[c];a=a[c]});return d},_renderData:function(){var a=
this;a.$layout.empty();if(1>a.options.data.length)a.$layout.text(a.options.emptyDataTemplate),a.options.pageable&&a._renderPager();else{var b=c.extend(!0,[],a.options.data),d=parseInt(a.options.pageIndex)*a.options.resultsPerPage,e=d+a.options.resultsPerPage,g=c(a.options.groupTemplate),k=null,f=itemHTML=groupHTML="";a._sort.property&&(b=a._sortData(b,a._sort.property),"desc"===a._sort.direction&&b.reverse());b=b.slice(d,e);a.options.formatter&&a.options.formatter(b);a.options.groupClass&&g.addClass(a.options.groupClass);
c.each(b,function(b,d){k=c(a.options.itemTemplate||"<div>");a.options.itemClass&&0===b%2&&k.addClass(a.options.itemClass);a.options.itemAlternateClass&&1===b%2&&k.addClass(a.options.itemAlternateClass);itemHTML="";c.each(a.options.items,function(b,e){itemHTML+=a._getValue(d,e)});a.options.itemTemplate&&(itemHTML=k.html(itemHTML).wrap("<p>").parent().html());a.options.itemdatabound&&a.options.itemdatabound(c(itemHTML),d);0===(b+1)%a.options.groupItemCount?(f+=g.html(groupHTML+itemHTML).wrap("<p>").parent().html(),
a.options.groupdatabound&&a.options.groupdatabound(g),group=c(a.options.groupTemplate),groupHTML=""):groupHTML+=itemHTML});a.$layout.html(f+g.html(groupHTML).wrap("<p>").parent().html());a._renderPager();a.options.databound&&a.$element.trigger("databound")}},_renderPager:function(){if(!this.options.pageable||1>=Math.ceil(this.options.data.length/this.options.resultsPerPage))if(0<this.$pager.length)this.$pager.empty();else return;0===this.$pager.length&&(this.$pager=c("<div>").addClass(this._class+
"-pager").appendTo(this.$element));this.options.pagerClass&&!this.$pager.hasClass(this.options.pagerClass)&&this.$pager.addClass(this.options.pagerClass);var a=Math.ceil(this.options.data.length/this.options.resultsPerPage),b=0,d=0,e="",b=1<this.options.pageIndex?this.options.pageIndex-2:0,d=b+5>a?a:b+5;d===a&&5!==d-b&&(b=-1<d-5?d-5:0);for(e='<a href="javascript:;" data-page="0">&lt;&lt;</a><a href="javascript:;" data-page="--">&lt;</a>';b<d;b++)e+='<a href="javascript:;"'+(b===this.options.pageIndex?
' class="active"':"")+' data-page="'+b+'">'+(b+1)+"</a>";e=e+'<a href="javascript:;" data-page="++">&gt;</a>'+('<a href="javascript:;" data-page="'+--a+'">&gt;&gt;</a>');this.$pager.html(e);this.options.pageClass&&this.$pager.find("a").addClass(this.options.pageClass)},_isNumeric:function(a){return c.isFunction(c.fn.isNumeric)?c.isNumeric(a):!isNaN(parseFloat(a))&&isFinite(a)},_each:function(a,b,d){if(null!==a)if(Array.prototype.forEach&&a.forEach===Array.prototype.forEach)a.forEach(b,d);else if(a.length===
+a.length)for(var e=0,c=a.length;e<c&&b.call(d,a[e],e,a)!==breaker;e++);else for(e in a)if(Object.prototype.call(a,e)&&b.call(d,a[e],e,a)===breaker)break},_filter:function(a,b,d){var e=[];if(null==a)return e;if(Array.prototype.filter&&a.filter===Array.prototype.filter)return a.filter(b,d);this._each(a,function(a,c,f){b.call(d,a,c,f)&&(e[e.length]=a)});return e},_map:function(a,b,d){var e=[];if(null===a)return e;if(Array.prototype.map&&a.map===Array.prototype.map)return a.map(b,d);this._each(a,function(a,
c,f){e[e.length]=b.call(d,a,c,f)});return e},_pluck:function(a,b){return this._map(a,function(a){return a[b]})},_sortData:function(a,b,c){var e=this,g=function(a){return e._getValue(a,b)};return this._pluck(this._map(a,function(a,b,e){return{value:a,index:b,criteria:g.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria.toString().toLowerCase(),d=b.criteria.toString().toLowerCase();/^(\-|NaN$)/.test(Date.parse(c))||/^(\-|NaN$)/.test(Date.parse(d))||(c=Date.parse(c),d=Date.parse(d));e._isNumeric(c)&&
e._isNumeric(d)&&(c=parseFloat(c),d=parseFloat(d));if(c!==d){if(c>d||void 0===c)return 1;if(c<d||void 0===d)return-1}return a.index<b.index?-1:1}),"value")}};c.fn[h]=function(a){var b=arguments;if(a===l||"object"===typeof a)return this.each(function(){c.data(this,"plugin_"+h)||c.data(this,"plugin_"+h,new m(this,a))});if("string"===typeof a&&"_"!==a[0]&&"init"!==a){var d;this.each(function(){var e=c.data(this,"plugin_"+h);e instanceof m&&"function"===typeof e[a]&&(d=e[a].apply(e,Array.prototype.slice.call(b,
1)))});return d!==l?d:this}}})(jQuery,this,document);